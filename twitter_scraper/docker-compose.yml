version: "3.7"

services:
    user_scraper:
        build: .
        image: "smag-twitter_scraper"
        command: ["-m", "twitterscraper.user_scraper"]
        depends_on:
            - "my-kafka"
        environment:
            KAFKA_HOST_PORT: "my-kafka:9092"
            KAFKA_FETCH_TOPIC: "user_names"
            KAFKA_INSERT_TOPIC: "users_scraped"
            KAFKA_CONSUMER_GROUP: "user_scraper"

    tweets_scraper:
        build: .
        image: "smag-twitter_scraper"
        command: ["-m", "twitterscraper.tweets_scraper"]
        depends_on:
            - "my-kafka"
        environment:
            KAFKA_HOST_PORT: "my-kafka:9092"
            KAFKA_FETCH_TOPIC: "user_names"
            KAFKA_INSERT_TOPIC: "tweets_scaped"
            KAFKA_CONSUMER_GROUP: "tweets_scraper"

    zookeeper:
        image: "wurstmeister/zookeeper:latest"
        ports:
            - "2181:2181"
    my-kafka:
        image: "wurstmeister/kafka:2.11-1.1.1"
        ports:
            - "9092:9092"
        depends_on:
            - "zookeeper"
        environment:
            KAFKA_CREATE_TOPICS: "user_names:4:1,users_scraped:4:1,tweets_scraped:4:1"
            KAFKA_ZOOKEEPER_CONNECT: "zookeeper:2181"
            KAFKA_LISTENERS: PLAINTEXT://:9092
            KAFKA_ADVERTISED_LISTENERS: PLAINTEXT://my-kafka:9092
        volumes:
            - "/var/run/docker.sock:/var/run/docker.sock"
    kafka-seed:
        build: .
        image: "smag-twitter_scraper"
        command: ["-m", "twitterscraper.insert_seed"]
        depends_on:
            - "my-kafka"
        environment:
            KAFKA_HOST_PORT: "my-kafka:9092"
            KAFKA_INSERT_TOPIC: "user_names"
            SEED_NAME: "urhengula5"
            SLEEP_SECONDS: "10"
